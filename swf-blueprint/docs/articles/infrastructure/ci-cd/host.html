

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Infrastructure host &mdash; software-factory 0.1.0-e41797b 2017-10-10 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="software-factory 0.1.0-e41797b 2017-10-10 documentation" href="../../../../../index.html"/>
        <link rel="up" title="Continuous integration and deployment" href="../../../../../chapters/ci-and-cd/index.html"/>
        <link rel="next" title="Jenkins" href="jenkins.html"/>
        <link rel="prev" title="Continuous integration and deployment" href="../../../../../chapters/ci-and-cd/index.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> software-factory
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../chapters/workflow/index.html">Git workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../chapters/baseplatform/index.html">Base Platform</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../chapters/ci-and-cd/index.html">Continuous integration and deployment</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Infrastructure host</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#host-nginx-configuration">Host Nginx configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jenkins.html">Jenkins</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-slaves.html">Build Slaves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../chapters/ci-and-cd/setting-up-automated-testing-yocto.html">Setting up automated testing on a NUC using Yocto</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../chapters/sdk/index.html">Software Development Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/index.html">C/C++ templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../licensing/index.html">Licensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">Introduction</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../index.html">software-factory</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../../chapters/ci-and-cd/index.html">Continuous integration and deployment</a> &raquo;</li>
      
    <li>Infrastructure host</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../_sources/swf-blueprint/docs/articles/infrastructure/ci-cd/host.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="infrastructure-host">
<h1>Infrastructure host<a class="headerlink" href="#infrastructure-host" title="Permalink to this headline">¶</a></h1>
<p>Because we run all the parts of the infrastructure like code hosting, cache, documentation, on different software and probably in docker containers there needs to be one host server which will work as a proxy server to give easy access to all the applications in the infrastructure in a easy way. It might also be responsible to serve static files like documentation and cache.</p>
<div class="section" id="host-nginx-configuration">
<h2>Host Nginx configuration<a class="headerlink" href="#host-nginx-configuration" title="Permalink to this headline">¶</a></h2>
<p>This is a example Nginx configuration which can be reused to set up a proxy server host:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>worker_processes  1;

events {
    worker_connections  1024;
}

http {

    include            mime.types;
    default_type       application/octet-stream;
    sendfile           on;
    keepalive_timeout  65;
    gzip               on;

    server {
        listen       80;
        server_name  localhost pelux.io;

        location / {
            root   /var/www/pelux.io;
            index  index.html index.htm;
        }

        location /yocto-cache/ {
            alias     /var/www/yocto-cache/archive/;
            index     index.html index.htm;
            autoindex on;
        }

        location /software-factory/ {
            alias /var/www/software-factory/
            index index.html index.htm
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }

        # Nginx configuration specific to Jenkins
        # Note that regex takes precedence, so use of &quot;^~&quot; ensures earlier evaluation
        location ^~ /jenkins/ {

            # Convert inbound WAN requests for https://domain.tld/jenkins/ to
            # local network requests for http://127.0.0.1:8080/jenkins/
            proxy_pass http://127.0.0.1:8080/jenkins/;

            # Rewrite HTTPS requests from WAN to HTTP requests on LAN
            # proxy_redirect http:// https://;

            # The following settings from https://wiki.jenkins-ci.org/display/JENKINS/Running+Hudson+behind+Nginx
            sendfile off;

            proxy_set_header   Host             $host:$server_port;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            proxy_max_temp_file_size 0;

            # this is the maximum upload size
            client_max_body_size       10m;
            client_body_buffer_size    128k;

            proxy_connect_timeout      90;
            proxy_send_timeout         90;
            proxy_read_timeout         90;

            proxy_buffer_size          4k;
            proxy_buffers              4 32k;
            proxy_busy_buffers_size    64k;
            proxy_temp_file_write_size 64k;

            # Required for new HTTP-based CLI
            proxy_http_version 1.1;
            proxy_request_buffering off;
        }
    }
}
</pre></div>
</div>
<p>The Jenkins jobs later need to be directed to write the yocto-cache and other artifacts to <code class="docutils literal"><span class="pre">/var/www/</span></code> so that this Nginx instance will be able to serve them via http(s).</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="jenkins.html" class="btn btn-neutral float-right" title="Jenkins" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../../../../chapters/ci-and-cd/index.html" class="btn btn-neutral" title="Continuous integration and deployment" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Pelagicore AB.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'0.1.0-e41797b 2017-10-10',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>