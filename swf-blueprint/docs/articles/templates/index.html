

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>C/C++ templates &mdash; software-factory 0.1.0-564e88a 2017-10-04 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="software-factory 0.1.0-564e88a 2017-10-04 documentation" href="../../../../index.html"/>
        <link rel="next" title="Licensing" href="../licensing/index.html"/>
        <link rel="prev" title="Software Development Kit" href="../../../../chapters/sdk/index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> software-factory
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../chapters/intro/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chapters/workflow/index.html">Git workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chapters/baseplatform/index.html">Base Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chapters/ci-and-cd/index.html">Continuous integration and deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../chapters/sdk/index.html">Software Development Kit</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">C/C++ templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#source-code-repository-directory-structure">Source code repository directory structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mandatory-files">Mandatory files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directory-naming">Directory naming</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-naming">File naming</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#template-library">Template library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compilation-and-installation">Compilation and installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#template-service">Template service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Compilation and installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-template-service">Running the template service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#install-directory-structure">Install directory structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#yocto-project-integration">Yocto Project integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#template-recipes">Template recipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#target-image-integration">Target image integration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../licensing/index.html">Licensing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">software-factory</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
    <li>C/C++ templates</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/swf-blueprint/docs/articles/templates/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="c-c-templates">
<h1>C/C++ templates<a class="headerlink" href="#c-c-templates" title="Permalink to this headline">¶</a></h1>
<p>The templates serve as example <a class="reference external" href="https://cmake.org/">CMake</a> projects for service developers
that should be used as a starting point while creating platform services
or shared libraries, as well as as a set of guidelines to follow in source
repositories. The guidelines described are not set-in-stone. Also, in
general, consistency is better than getting stuck on difficult-to-apply
guidelines so please use these to an extent which is reasonable. The point
is to support a common pattern within the project.</p>
<p>In order to compile the templates natively the user needs to use the CMake
build system. The CMake build system can be installed by following the
instructions on the <a class="reference external" href="https://cmake.org/install/">CMake install webpage</a> or by using your Linux
distribution’s package manager.</p>
<div class="section" id="source-code-repository-directory-structure">
<h2>Source code repository directory structure<a class="headerlink" href="#source-code-repository-directory-structure" title="Permalink to this headline">¶</a></h2>
<p>In order to make it easier to navigate through new repositories they
should follow a common directory structure. The tree structure below
shows a repository with two components sharing a ‘doc’ directory and
‘component-test’ directory. Many repos will likely contain only one
component, in which case the structure should be the same but with only
one subdirectory with the source code etc.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>.
├── cmake_modules
├── component-A
│   ├── include
│   ├── src
│   ├── unit-test
│   │   ├── test-data
├── component-B
│   ├── include
│   ├── src
│   ├── unit-test
│   │   ├── test-data
├── component-test
│   ├── test-data
├── doc
│   ├── images
│   │   └── *.png
│   ├── design.md
│   ├── mainpage.h
├── scripts
├── DEPENDENCIES
├── LICENSE
└── README.md
</pre></div>
</div>
<p>The table below describes the directories and their purpose. The
&lt;component-subdir&gt; represents e.g. the ‘component-A’ or ‘component-B’
directories in the tree structure above. Some directories are only
relevant in some situations, e.g. a ‘test-data’ dir is only relevant
if there is any actual test data of course.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Directory</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>scripts</td>
<td>Contains e.g. utility scripts that might be needed to e.g. set up an environment or such like.</td>
</tr>
<tr class="row-odd"><td>cmake_modules</td>
<td>Contains any CMake ‘find’ modules.</td>
</tr>
<tr class="row-even"><td>doc</td>
<td>Contains doxygen files for generating reference documentation that is not part of any class
etc, e.g. introductory pages and topic overviews. Contains design.md, describing the design
of the component in an arc42 structure.</td>
</tr>
<tr class="row-odd"><td>doc/images</td>
<td>Contains images for the design and doxygen documentation.
The preferred file format is png. If the image is generated from another document, it is
recommended to keep that document here as well, e.g. a UML model.</td>
</tr>
<tr class="row-even"><td>component-test</td>
<td>Contains tests and any stubs used in component tests.</td>
</tr>
<tr class="row-odd"><td>component-test/test-data</td>
<td>Contains any test data that the component tests uses.</td>
</tr>
<tr class="row-even"><td>&lt;component-subdir&gt;/include</td>
<td>Contains any public header files, those that would typically be installed in a development package.</td>
</tr>
<tr class="row-odd"><td>&lt;component-subdir&gt;/src</td>
<td>Contains source and private header files.</td>
</tr>
<tr class="row-even"><td>&lt;component-subdir&gt;/unit-test</td>
<td>Contains unit tests and any stubs used in unit tests.</td>
</tr>
<tr class="row-odd"><td>&lt;component-subdir&gt;/unit-test/test-data</td>
<td>Contains any test data that the unit tests uses.</td>
</tr>
</tbody>
</table>
<div class="section" id="mandatory-files">
<h3>Mandatory files<a class="headerlink" href="#mandatory-files" title="Permalink to this headline">¶</a></h3>
<p>Certain files should be found in every repository, those files are described below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>README(.md)</td>
<td>A top-level README giving a brief introduction to the repository.
How to build, how to run tests, other “good to know” information.
The .md suffix for markdown syntax may be used.</td>
</tr>
<tr class="row-odd"><td>LICENSE</td>
<td>The source code and project license.</td>
</tr>
<tr class="row-even"><td>DEPENDENCIES</td>
<td>Describes any non-trivial dependency used by a component.
Typically a library linked against such as libfoo would be listed while a compiler and libstdc++ would not be listed.</td>
</tr>
<tr class="row-odd"><td>CONTRIBUTING.md</td>
<td><dl class="first last docutils">
<dt>For OSS projects this file should exist and contain the following information:</dt>
<dd><ul class="first last simple">
<li>How and where to file bug reports and what information is expected in them.</li>
<li>How the development flow works, for instance forks and merge requests.</li>
<li>Brief about code standard</li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td>doc/mainpage.h</td>
<td>Introductory component documentation.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="directory-naming">
<h3>Directory naming<a class="headerlink" href="#directory-naming" title="Permalink to this headline">¶</a></h3>
<p>All directories should be lower case only, and using “-” as a separator
between words. No other symbols other than [a..z], [0..9] and “-” are
allowed. Exceptions are allowed if there is a technical need which is
cumbersome to work around.</p>
</div>
<div class="section" id="file-naming">
<h3>File naming<a class="headerlink" href="#file-naming" title="Permalink to this headline">¶</a></h3>
<p>The source code and header files should be named using lower case letters
only, without any word separator. No other symbols other than [a..z] and
[0..9] are allowed. C++ source files should be suffixed “.cpp” and header
files “.h”. The exception is test code files where an underscore is used
to separate the name of what is tested and a suffix showing that it is a
test, e.g. a unit with the name ‘mymodule.cpp’/’mymodule.h’ would have a
corresponding unit test implemented in a file named
‘mymodule_unittest.cpp’.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The repository meta data files such as the readme, license and makefiles are allowed to use upper case letters in their naming.</p>
</div>
</div>
</div>
<div class="section" id="template-library">
<h2>Template library<a class="headerlink" href="#template-library" title="Permalink to this headline">¶</a></h2>
<p>The template library provides an example <a class="reference external" href="https://cmake.org/">CMake</a> shared library project for
service developers.</p>
<p>To acquire the template service source code the user needs to fetch the
code from github.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone https://github.com/Pelagicore/template-library.git
</pre></div>
</div>
<div class="section" id="compilation-and-installation">
<h3>Compilation and installation<a class="headerlink" href="#compilation-and-installation" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> template-library
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span>/path/to/install/dir .. <span class="o">&amp;&amp;</span> make -j4
make install
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The example above presents how to compile and install the template library natively on
your host machine.</p>
</div>
</div>
</div>
<div class="section" id="template-service">
<h2>Template service<a class="headerlink" href="#template-service" title="Permalink to this headline">¶</a></h2>
<p>The template service serves as an example <a class="reference external" href="https://cmake.org/">CMake</a> project for service
developers that should be used as a starting point while creating platform
services.</p>
<p>To acquire the template service source code the user needs to fetch the
code from github.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone https://github.com/Pelagicore/template-service.git
</pre></div>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>The template service depends on the template library. That is reflected in its <cite>CMakeLists.txt</cite>
file. The build system will check if the required dependencies are installed on the system through
<a class="reference external" href="https://www.freedesktop.org/wiki/Software/pkg-config/">pkg-config</a>.</p>
</div>
<div class="section" id="id1">
<h3>Compilation and installation<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> template-service
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
<span class="nv">PKG_CONFIG_PATH</span><span class="o">=</span>/path/to/install/dir/lib/pkgconfig <span class="se">\</span>
cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span>/path/to/install/dir .. <span class="o">&amp;&amp;</span> make -j4
make install
</pre></div>
</div>
</div>
<div class="section" id="running-the-template-service">
<h3>Running the template service<a class="headerlink" href="#running-the-template-service" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/path/to/install/dir/lib <span class="se">\</span>
path/to/install/dir/bin/template-service
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The example above presents how to compile, install and run the template service natively
on your host machine.</p>
</div>
</div>
</div>
<div class="section" id="install-directory-structure">
<h2>Install directory structure<a class="headerlink" href="#install-directory-structure" title="Permalink to this headline">¶</a></h2>
<p>Once the template service and library are installed, the layout of the installation will be as shown
below.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>.
├── bin
│   └── template-service
├── include
│   └── template-library
│       └── templatepublicclass.h
└── lib
    ├── libtemplate-library.so
    └── pkgconfig
        └── template-library.pc
</pre></div>
</div>
</div>
<div class="section" id="yocto-project-integration">
<h2>Yocto Project integration<a class="headerlink" href="#yocto-project-integration" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to include a shared library or platform service in the target image using
the <a class="reference external" href="https://www.yoctoproject.org/">Yocto Project</a>. A key part of this is an open source build system, based around the
OpenEmbedded architecture, that enables developers to create their own Linux distribution specific
to their environment. <a class="reference external" href="https://www.yoctoproject.org/docs/current/bitbake-user-manual/bitbake-user-manual.html">BitBake</a> is the build tool used in this setup:</p>
<blockquote>
<div>BitBake executes tasks according to provided metadata that builds up the tasks. Metadata is
stored in recipe (.bb) and related recipe “append” (<code class="docutils literal"><span class="pre">.bbappend</span></code>) files, configuration
(<code class="docutils literal"><span class="pre">.conf</span></code>) and underlying include (<code class="docutils literal"><span class="pre">.inc</span></code>) files, and in class (<code class="docutils literal"><span class="pre">.bbclass</span></code>) files. The
metadata provides BitBake with instructions on what tasks to run and the dependencies between
those tasks.</div></blockquote>
<p>The developed software components are added to the project through a BitBake recipe file that, as
mentioned above, stores the component metadata. Guidelines on how to write BitBake recipes can be
found in the <a class="reference external" href="http://www.yoctoproject.org/docs/current/ref-manual/ref-manual.html">Yocto reference manual</a> and the reference structure is described in the <a class="reference external" href="http://www.openembedded.org/wiki/Styleguide">OpenEmbedded
style guide</a>.</p>
<div class="section" id="template-recipes">
<h3>Template recipes<a class="headerlink" href="#template-recipes" title="Permalink to this headline">¶</a></h3>
<p>Below is a template Yocto recipe for the template-service. See inline comments for description of
the different fields available.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Various meta-data. Description is the only mandatory field here.</span>
<span class="nv">SUMMARY</span> <span class="o">=</span> <span class="s2">&quot;A template C/C++ service&quot;</span>
<span class="nv">DESCRIPTION</span> <span class="o">=</span> <span class="s2">&quot;A C/C++ source code repository blueprint&quot;</span>
<span class="nv">AUTHOR</span> <span class="o">=</span> <span class="s2">&quot;Gordan Markuš &lt;gordan.markus@pelagicore.com&gt;&quot;</span>
<span class="nv">HOMEPAGE</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/Pelagicore/template-service&quot;</span>

<span class="c1"># Short license name and where to find the license file plus its checksum. This is so that yocto</span>
<span class="c1"># can check if the license text changes in newer versions of the software</span>
<span class="nv">LICENSE</span> <span class="o">=</span> <span class="s2">&quot;MPL-2.0&quot;</span>
<span class="nv">LIC_FILES_CHKSUM</span> <span class="o">=</span> <span class="s2">&quot;file://LICENSE;md5=815ca599c9df247a0c7f619bab123dad&quot;</span>

<span class="c1"># Dependencies for building this software.</span>
<span class="nv">DEPENDS</span> <span class="o">=</span> <span class="s2">&quot;template-library&quot;</span>

<span class="c1"># Version and revision. It is in general possible to have several versions of the same software</span>
<span class="c1"># on the same system</span>
<span class="nv">PV</span> <span class="o">=</span> <span class="s2">&quot;1.0+git</span><span class="si">${</span><span class="nv">SRCREV</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">PR</span> <span class="o">=</span> <span class="s2">&quot;r0&quot;</span>

<span class="c1"># Where to find the sources and, in the case the source is at a cvs, what revision to build</span>
<span class="nv">SRCREV</span> <span class="o">=</span> <span class="s2">&quot;5bce3d20f996dac7e3882f48f5057abb7e1d05f5&quot;</span>
<span class="nv">SRC_URI</span> <span class="o">=</span> <span class="s2">&quot;git://github.com/Pelagicore/template-service.git;protocol=https;branch=master&quot;</span>

<span class="c1"># Where the sources are placed</span>
<span class="nv">S</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">WORKDIR</span><span class="si">}</span><span class="s2">/git/&quot;</span>

<span class="c1"># What classes to use. The template-service is a cmake project that uses pkgconfig. In general,</span>
<span class="c1"># just inheriting these classes makes building completely automatic without any need to tinker.</span>
inherit cmake pkgconfig
</pre></div>
</div>
</div>
<div class="section" id="target-image-integration">
<h3>Target image integration<a class="headerlink" href="#target-image-integration" title="Permalink to this headline">¶</a></h3>
<p>To include the template service in the target image, the following line has to be added to the
target image BitBake recipe:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">IMAGE_INSTALL</span> <span class="o">+=</span> <span class="s2">&quot;template-service&quot;</span>
</pre></div>
</div>
<p>Observe that there is no need to add the template library explicitly. The template library will be
included implicitly because the template service depends on it.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../licensing/index.html" class="btn btn-neutral float-right" title="Licensing" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../../../chapters/sdk/index.html" class="btn btn-neutral" title="Software Development Kit" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Pelagicore AB.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'0.1.0-564e88a 2017-10-04',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>